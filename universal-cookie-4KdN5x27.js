var p={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var E;function D(){if(E)return p;E=1,p.parse=_,p.serialize=b;var s=Object.prototype.toString,r=Object.prototype.hasOwnProperty,t=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,o=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,f=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,S=/^[\u0020-\u003A\u003D-\u007E]*$/;function _(i,a){if(typeof i!="string")throw new TypeError("argument str must be a string");var e={},c=i.length;if(c<2)return e;var l=a&&a.decode||x,n=0,u=0,h=0;do{if(u=i.indexOf("=",n),u===-1)break;if(h=i.indexOf(";",n),h===-1)h=c;else if(u>h){n=i.lastIndexOf(";",u-1)+1;continue}var d=k(i,n,u),w=v(i,u,d),m=i.slice(d,w);if(!r.call(e,m)){var g=k(i,u+1,h),C=v(i,h,g);i.charCodeAt(g)===34&&i.charCodeAt(C-1)===34&&(g++,C--);var j=i.slice(g,C);e[m]=A(j,l)}n=h+1}while(n<c);return e}function k(i,a,e){do{var c=i.charCodeAt(a);if(c!==32&&c!==9)return a}while(++a<e);return e}function v(i,a,e){for(;a>e;){var c=i.charCodeAt(--a);if(c!==32&&c!==9)return a+1}return e}function b(i,a,e){var c=e&&e.encode||encodeURIComponent;if(typeof c!="function")throw new TypeError("option encode is invalid");if(!t.test(i))throw new TypeError("argument name is invalid");var l=c(a);if(!o.test(l))throw new TypeError("argument val is invalid");var n=i+"="+l;if(!e)return n;if(e.maxAge!=null){var u=Math.floor(e.maxAge);if(!isFinite(u))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+u}if(e.domain){if(!f.test(e.domain))throw new TypeError("option domain is invalid");n+="; Domain="+e.domain}if(e.path){if(!S.test(e.path))throw new TypeError("option path is invalid");n+="; Path="+e.path}if(e.expires){var h=e.expires;if(!T(h)||isNaN(h.valueOf()))throw new TypeError("option expires is invalid");n+="; Expires="+h.toUTCString()}if(e.httpOnly&&(n+="; HttpOnly"),e.secure&&(n+="; Secure"),e.partitioned&&(n+="; Partitioned"),e.priority){var d=typeof e.priority=="string"?e.priority.toLowerCase():e.priority;switch(d){case"low":n+="; Priority=Low";break;case"medium":n+="; Priority=Medium";break;case"high":n+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(e.sameSite){var w=typeof e.sameSite=="string"?e.sameSite.toLowerCase():e.sameSite;switch(w){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return n}function x(i){return i.indexOf("%")!==-1?decodeURIComponent(i):i}function T(i){return s.call(i)==="[object Date]"}function A(i,a){try{return a(i)}catch{return i}}return p}var O=D();function N(){const s=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof s=="boolean"?s:typeof document=="object"&&typeof document.cookie=="string"}function L(s){return typeof s=="string"?O.parse(s):typeof s=="object"&&s!==null?s:{}}function y(s,r={}){const t=I(s);if(!r.doNotParse)try{return JSON.parse(t)}catch{}return s}function I(s){return s&&s[0]==="j"&&s[1]===":"?s.substr(2):s}class U{constructor(r,t={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const f=this.cookies;this.cookies=O.parse(document.cookie),this._checkChanges(f)};const o=typeof document>"u"?"":document.cookie;this.cookies=L(r||o),this.defaultSetOptions=t,this.HAS_DOCUMENT_COOKIE=N()}_emitChange(r){for(let t=0;t<this.changeListeners.length;++t)this.changeListeners[t](r)}_checkChanges(r){new Set(Object.keys(r).concat(Object.keys(this.cookies))).forEach(o=>{r[o]!==this.cookies[o]&&this._emitChange({name:o,value:y(this.cookies[o])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(r,t={}){return t.doNotUpdate||this.update(),y(this.cookies[r],t)}getAll(r={}){r.doNotUpdate||this.update();const t={};for(let o in this.cookies)t[o]=y(this.cookies[o],r);return t}set(r,t,o){o?o=Object.assign(Object.assign({},this.defaultSetOptions),o):o=this.defaultSetOptions;const f=typeof t=="string"?t:JSON.stringify(t);this.cookies=Object.assign(Object.assign({},this.cookies),{[r]:f}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=O.serialize(r,f,o)),this._emitChange({name:r,value:t,options:o})}remove(r,t){const o=t=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),t),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[r],this.HAS_DOCUMENT_COOKIE&&(document.cookie=O.serialize(r,"",o)),this._emitChange({name:r,value:void 0,options:t})}addChangeListener(r){this.changeListeners.push(r),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(r){const t=this.changeListeners.indexOf(r);t>=0&&this.changeListeners.splice(t,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}export{U as C};
